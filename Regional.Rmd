---
title: "Regional Analyze"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include = FALSE}
library(tidyverse)
library(ggplot2)
library(plotly)
library(sf) 
```

```{r, include = FALSE}
load("data/mergedPA.RData")
```

---
The number of restaurant observations varies significantly across counties in Southeastern Pennsylvania, with Philadelphia leading at 3,426 and Berks having only 22. This disparity highlights potential differences in population density, urbanization, or data representation in Yelp's dataset. Such variation could influence future analyses, especially in identifying underserved areas or trends in restaurant quality and accessibility between urban and less-populated regions.

```{r plot number of restaurant in county, fig.width=8}
county_counts <- mergedPA |>
  group_by(county) |>
  summarise(count = n(), .groups = "drop") |>
  mutate(county = fct_reorder(county, count)) 

county_counts |>
  knitr::kable()

plot_ly(
  data = county_counts,
  x = ~county,
  y = ~count,
  color = ~county,
  type = "bar",
  colors = "viridis"
) |> 
  layout(
    title = "Number of Entries by County",
    xaxis = list(title = "County", showticklabels = TRUE),
    yaxis = list(title = "Count"),
    showlegend = FALSE
  )
```

The average ratings of restaurants by county in Southeastern Pennsylvania reveal an interesting trend. Berks County, despite having the fewest restaurant observations, boasts the highest average rating. This might be attributed to the limited number of observations, as previously mentioned. In contrast, the other counties, each with hundreds of restaurants, exhibit more stable average ratings. Among these, Philadelphia stands out with the highest average score, reflecting its diverse and competitive restaurant scene.

```{r plot average star, fig.width=8}
avg_stars <- mergedPA |>
  group_by(county) |>
  summarise(avg_stars = mean(stars, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(avg_stars)) |> 
  mutate(county = fct_reorder(county, avg_stars))

plot_ly(
  data = avg_stars,
  x = ~county,
  y = ~avg_stars,
  color = ~county,
  type = "bar",
  colors = "viridis"
) |> 
  layout(
    title = "Average Ratings by County",
    xaxis = list(title = "County", showticklabels = TRUE),
    yaxis = list(title = "Average Stars", range = c(3, 4)),
    showlegend = FALSE
  )
```

Based on Top 10 restaurant tags across counties in Southeastern Pennsylvania,  Pizza and Sandwiches dominate as the most popular restaurant types, with Philadelphia significantly contributing to their high counts. American (Traditional) and Breakfast & Brunch also feature prominently, reflecting common preferences in the region. Interestingly, while counties like Philadelphia and Montgomery contribute the most to these tags, smaller counties like Berks have minimal representation across all tags. This stacked visualization provides insight into both the diversity and distribution of restaurant types across counties.
 
```{r popular histogram plot, fig.width=8}
stacked_data <- mergedPA |>
  separate_rows(categories, sep = ",\\s*") |> 
  group_by(categories, county) |>
  summarise(count = n(), .groups = "drop") |>  
  ungroup()

top_tags <- stacked_data |>
  group_by(categories) |>
  summarise(total_count = sum(count), .groups = "drop") |>
  arrange(desc(total_count)) |>
  slice_max(total_count, n = 10) |>
  pull(categories) 

stacked_data <- stacked_data |>
  filter(categories %in% top_tags) |>
  mutate(categories = factor(categories, levels = top_tags))
  

plot_ly(
  data = stacked_data,
  x = ~categories,       
  y = ~count,         
  color = ~county,   
  type = "bar",       
  colors = "viridis"
) |> 
  layout(
    title = "Top 10 Restaurant Tags by County",
    xaxis = list(title = "Restaurant Tag", tickangle = 45), 
    yaxis = list(title = "Count"),
    barmode = "stack"
  )

```